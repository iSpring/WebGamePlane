window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){setTimeout(a,1e3/60)},window.Game={instanceOf:function(a,b){return a&&a.instanceOf&&a.instanceOf(b)?!0:!1},isNumber:function(a){return"number"==typeof a},isString:function(a){return"string"==typeof a},isBool:function(a){return"boolean"==typeof a},isCanvas:function(a){return a instanceof HTMLElement&&"CANVAS"==a.tagName.toUpperCase()},isDiv:function(a){return a instanceof HTMLElement&&"DIV"==a.tagName.toUpperCase()},isiOS:function(){var a=navigator.userAgent.toLowerCase();return a.indexOf("iphone")>=0||a.indexOf("ipad")>=0},isAndroid:function(){var a=navigator.userAgent.toLowerCase();return a.indexOf("android")>=0},addScore:function(a){var c,b=this.getScoreDom();b&&this.isNumber(a)&&a>0&&(c=parseInt(b.innerHTML),c+=a,b.innerHTML=c)},getCanvas:function(){return null},getRenderer:function(){return null},getSpriteFactory:function(){return null},getWebSocketManager:function(){return null},getScoreDom:function(){},getOperationDom:function(){return null},isRunning:function(){return!1},getAwardCount:function(){return 0},receiveAward:function(){},receiveBombAward:function(){this.receiveAward()},useBombAward:function(){},gameOver:function(){},restart:function(){},start:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;this.isRunning()||(b=!1,this.isRunning=function(){return b},c=0,this.getAwardCount=function(){return c},this.receiveAward=function(){c++},a=a||{},d=a.container,this.isDiv(d)&&(d.innerHTML="",d.style.cssText+="position:relative;cursor:default;background-repeat:repeat",d.style.backgroundImage="url(images/bg.gif)",e=document.createElement("div"),d.appendChild(e),e.style.cssText+="display:none;position:absolute;left:0px;bottom:0px;height:45px;",f=document.createElement("div"),e.appendChild(f),f.style.cssText+="float:left;width:42px;height:45px;background-repeat:no-repeat;",f.style.backgroundImage="url(images/bomb.gif)",g=document.createElement("div"),e.appendChild(g),g.style.cssText+="float:left;height:100%;line-height:45px;margin-left:8px;",g.innerHTML="x 0",h=0,this.receiveBombAward=function(){this.receiveAward(),h++,g.innerHTML="x "+h,e.style.display="block"},this.useBombAward=function(){var a,b;if(!y.isCollide()){if(h>0)for(h--,a=x.scene.getSpritesByType("Game.EnemyPlane");a.length>0;)b=a[0],b.explode(),a.splice(0,1);0==h&&(e.style.display="none"),g.innerHTML="x "+h}},i=document.createElement("canvas"),i.style.cssText+="position:absolute;left:0px;top:0px;",this.getCanvas=function(){return i},i.style.cursor="default",i.width=d.clientWidth>0?d.clientWidth:480,i.height=d.clientHeight>0?d.clientHeight:700,d.appendChild(i),j=document.createElement("div"),j.style.cssText+="position:absolute;left:15px;top:15px;height:30px;",d.appendChild(j),k=document.createElement("div"),k.style.cssText+="float:left;width:29px;height:30px;background-repeat:no-repeat;",j.appendChild(k),k.style.backgroundImage="url(images/pause.png)",l=document.createElement("div"),this.getScoreDom=function(){return l},l.innerHTML="0",l.style.cssText+="float:left;height:100%;line-height:30px;margin-left:15px;font-weight:bold;",j.appendChild(l),m=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),m.style.display="none",m.style.cssText+="position:absolute;width:200px;z-index:1000;text-align: center;",m.style.left=(i.width-200)/2+"px",m.style.top=(i.height-72)/2+"px",d.appendChild(m),m.appendChild(n),m.appendChild(o),p="background-color:#D7DDDE;height:24px;line-height:24px;border:1px solid;",p+="-webkit-border-radius:12px;-moz-border-radius:12px;-o-border-radius:12px;-ms-border-radius:12px;border-radius:12px;",n.style.cssText+=p,o.style.cssText+=p,o.style.marginTop="20px",n.innerHTML="继续",o.innerHTML="重新开始",this.getOperationDom=function(){return m},q=document.createElement("div"),d.appendChild(q),q.style.cssText+="display:none;position:absolute;width:280px;background-color:#D7DDDE;border:2px solid #515151;text-align:center;",q.style.cssText+="-webkit-border-radius:10px;-moz-border-radius:10px;-o-border-radius:10px;-ms-border-radius:10px;border-radius:10px;",q.style.left=(i.width-280)/2+"px",q.style.top=(i.height-230)/2+"px",r=document.createElement("div"),q.appendChild(r),r.style.cssText+="height:50px;line-height:50px;border-bottom:2px solid #515151;",r.innerHTML="飞机大战分数",s=document.createElement("div"),q.appendChild(s),s.style.cssText+="height:108px;line-height:108px;border-bottom:2px solid #515151;",s.innerHTML="0",t=document.createElement("div"),q.appendChild(t),t.style.cssText+="height:64px;overflow:hidden;",u=document.createElement("div"),t.appendChild(u),u.style.cssText+="width:120px;height:32px;line-height:32px;margin:16px auto 0px auto;border:2px solid #515151;",u.style.cssText+="-webkit-border-radius:16px;-moz-border-radius:16px;-o-border-radius:16px;-ms-border-radius:16px;border-radius:16px;",u.innerHTML="继续",this.gameOver=function(){s.innerHTML=l.innerHTML,c=0,h=0,b=!1,j.style.display="none",e.style.display="none",m.style.display="none",q.style.display="block",x.pause(),setTimeout(function(){x.scene.clear()},100)},v=i.getContext("2d"),w=Game.SpriteFactoryMaker(a),this.getSpriteFactory=function(){return w},x=Game.RendererMaker(v),this.getRenderer=function(){return x},y=w.createCombatAircraft(),y.moveToCenterBottom(i),x.scene.add(y),k.addEventListener("click",function(){b&&(x.pause(),k.style.backgroundPosition="-50px 0px",m.style.display="block",b=!1)},!1),n.addEventListener("click",function(){b||(m.style.display="none",k.style.backgroundPosition="0px 0px",x.run(),b=!0)},!1),this.restart=function(){c=0,h=0,j.style.display="block",k.style.backgroundPosition="0px 0px",l.innerHTML="0",m.style.display="none",e.style.display="none",g.innerHTML="x 0",q.style.display="none",s.innerHTML="0",x.pause(),setTimeout(function(){x.scene.clear(),y.moveToCenterBottom(i),y.setNotCollide(),x.scene.add(y),x.run(),b=!0},100)},o.addEventListener("click",Game.restart,!1),u.addEventListener("click",Game.restart,!1),z=Game.WebSocketControlerMaker(),this.getWebSocketManager=function(){return z},x.run(),b=!0))}},Game.BaseMaker=function(){var a=["Game.Base"],b={instanceOf:function(b){for(var c=0,d=a.length;d>c;c++)if(b==a[c])return!0;return!1},addType:function(b){var c=this.instanceOf(b);c||a.push(b)}};return b},Game.WebSocketControlerMaker=function(){var url="ws://"+location.hostname+":8888",webSocket=null,wsc=Game.BaseMaker();return wsc.pause=function(){webSocket&&webSocket.readyState==webSocket.OPEN&&webSocket.send("running:false")},wsc.run=function(){webSocket&&webSocket.readyState==webSocket.OPEN&&webSocket.send("running:true")},document.body.onunload=function(){webSocket&&webSocket.close()},window.WebSocket&&(webSocket=new WebSocket(url),webSocket.onopen=function(){var a,b;webSocket.readyState==webSocket.OPEN&&(a=Game.getCanvas(),a&&(b=parseInt(a.width),webSocket.send("width:"+b)))},webSocket.onmessage=function(event){var running,renderer,spriteFactory,sprite,str=event.data,args=eval("("+str+")");console.log(args),running=Game.isRunning(),renderer=Game.getRenderer(),spriteFactory=Game.getSpriteFactory(),running&&renderer&&spriteFactory&&(sprite=null,"SmallPlane"==args.type?sprite=spriteFactory.createSmallEnemyPlane(args):"MiddlePlane"==args.type?sprite=spriteFactory.createMiddleEnemyPlane(args):"BigPlane"==args.type?sprite=spriteFactory.createBigEnemyPlane(args):"BombAward"==args.type?sprite=spriteFactory.createBombAward(args):"BulletAward"==args.type&&(sprite=spriteFactory.createBulletnAward(args)),sprite&&renderer.scene.add(sprite))},webSocket.onclose=function(){alert("连接关闭")}),wsc},Game.SpriteFactoryMaker=function(a){var b,c,d,e,f,g,h,i,j,k;return a=a||{},b=a.combatAircraftMaterial,c=a.explosionMaterial,d=a.yellowBulletMaterial,e=a.blueBulletMaterial,f=a.smallEnemyPlaneMaterial,g=a.middleEnemyPlaneMaterial,h=a.bigEnemyPlaneMaterial,i=a.bombAwardMaterial,j=a.bulletAwardMaterial,k=Game.BaseMaker(),k.addType("Game.SpriteFactory"),k.createCombatAircraft=function(a){return a=a||{},a.material=b,Game.CombatAircraftMaker(a)},k.createExplosion=function(a){return a=a||{},a.segment=14,a.material=c,Game.ExplosionMaker(a)},k.createYellowBullet=function(a){return a=a||{},a.material=d,Game.BulletMaker(a)},k.createBlueBullet=function(a){return a=a||{},a.material=e,Game.BulletMaker(a)},k.createSmallEnemyPlane=function(a){return a=a||{},a.material=f,Game.SmallEnemyPlaneMaker(a)},k.createMiddleEnemyPlane=function(a){return a=a||{},a.material=g,Game.MiddleEnemyPlaneMaker(a)},k.createBigEnemyPlane=function(a){return a=a||{},a.material=h,Game.BigEnemyPlaneMaker(a)},k.createBombAward=function(a){return a=a||{},a.material=i,Game.BombAwardMaker(a)},k.createBulletnAward=function(a){return a=a||{},a.material=j,Game.BulletAwardMaker(a)},k},Game.EventManagerMaker=function(a){function l(a){a.preventDefault(),Game.isRunning()&&(e=a.layerX||a.offsetX,f=a.layerY||a.offsetY,d=!0)}function m(a){var b,g,h,i;a.preventDefault(),d&&Game.isRunning()&&(b=c.getCombatAircraft(),b&&(g=b.isCollide(),g||(h=a.layerX||a.offsetX,i=a.layerY||a.offsetY,b.move(h-e,i-f),e=h,f=i)))}function n(a){a.preventDefault(),Game.isRunning()&&(d=!1,e=-1,f=-1)}function o(){Game.useBombAward()}function p(a){if(Game.isRunning()&&a.targetTouches.length>0){var b=a.targetTouches[0];e=b.pageX,f=b.pageY,d=!0}i=new Date}function q(a){var b,g,h,i,j;a.preventDefault(),d&&Game.isRunning()&&a.targetTouches.length>0&&(b=c.getCombatAircraft(),b&&(g=b.isCollide(),g||(h=a.targetTouches[0],i=h.pageX,j=h.pageY,b.move(i-e,j-f),e=i,f=j)))}function r(){var b,c,k,l;Game.isRunning()&&(d=!1,e=-1,f=-1),j=new Date,b=j.getTime(),c=i.getTime(),k=b-c,200>=k&&(l=b-h.getTime(),300>l?(Game.useBombAward(),h=g):h=j)}var b,c,d,e,f,g,h,i,j,k;return a=a||{},b=Game.isCanvas(a.canvas)?a.canvas:null,c=Game.instanceOf(a.scene,"Game.Scene")?a.scene:null,d=!1,e=-1,f=-1,g=new Date,g.setFullYear(g.getFullYear()-100),h=g,i=g,j=g,k=Game.BaseMaker(),k.addType("Game.EventManager"),b&&c&&(document.body.addEventListener("mousedown",l,!1),b.addEventListener("mousemove",m,!1),document.body.addEventListener("mouseup",n,!1),b.addEventListener("dblclick",o,!1),b.addEventListener("touchstart",p,!1),b.addEventListener("touchmove",q,!1),b.addEventListener("touchend",r,!1)),k},Game.SceneMaker=function(a){var b=[],c=null,d=a instanceof CanvasRenderingContext2D?a:null,e=0,f=Game.BaseMaker();return f.addType("Game.Scene"),f.getSprites=function(){return b},f.getCombatAircraft=function(){return c},f.add=function(a){return Game.instanceOf(a,"Game.CombatAircraft")?c?!1:(b.push(a),a.setScene(this),c=a,!0):Game.instanceOf(a,"Game.Sprite")?(b.push(a),a.setScene(this),!0):!1},f.remove=function(a){var d,e,f;if(Game.instanceOf(a,"Game.Sprite"))for(d=0,e=b.length;e>d;d++)if(f=b[d],a==f)return b.splice(d,1),a==c&&(c=null),!0;return!1},f.getSpritesByType=function(a){var d,e,f,c=[];if(Game.isString(a))for(d=0,e=b.length;e>d;d++)f=b[d],Game.instanceOf(f,a)&&c.push(f);return c},f.clear=function(){for(var a,e;b.length>0;)a=b[0],a.destroy();b=[],c=null,d&&(e=d.canvas,d.clearRect(0,0,e.width,e.height))},f.beforeDraw=function(){var a,b,d,e;if(c)for(a=c.getY(),b=this.getSpritesByType("Game.Bullet");b.length>0;)d=b[0],e=d.getY(),e>=a&&d.destroy(),b.splice(0,1)},f.draw=function(){var a,c,f,g;if(e++,this.beforeDraw(),d instanceof CanvasRenderingContext2D){for(d.clearRect(0,0,d.canvas.width,d.canvas.height),a=[],c=0,f=b.length;f>c;c++)a.push(b[c]);for(;a.length>0;)g=a[0],g.draw(d),a.splice(0,1)}this.afterDraw()},f.afterDraw=function(){},f},Game.RendererMaker=function(a){function f(){b&&c&&(e.scene.draw(b),window.requestAnimationFrame(g))}function g(){c&&f.apply(e,arguments)}var b=a instanceof CanvasRenderingContext2D?a:null,c=!1,d=null,e=Game.BaseMaker();return e.addType("Game.Renderer"),e.scene=Game.SceneMaker(b),b&&b.canvas&&(d=Game.EventManagerMaker({canvas:b.canvas,scene:e.scene})),e.run=function(){!c&&b&&(c=!0,g());var a=Game.getWebSocketManager();a&&a.run()},e.pause=function(){c=!1;var a=Game.getWebSocketManager();a&&a.pause()},e},Game.SpriteMaker=function(a){var b,c,d,e,f,g,h,i,j;return a=a||{},b=null,c=null,d=Game.isBool(a.visible)?a.visible:!0,e=Game.isNumber(a.x)?a.x:0,f=Game.isNumber(a.y)?a.y:0,g=Game.isNumber(a.collideOffset)&&a.collideOffset>=0?a.collideOffset:0,h=a.material instanceof Image&&a.material.width>0&&a.material.height>0?a.material:null,i=0,j=Game.BaseMaker(),j.addType("Game.Sprite"),j.getContext2d=function(){return b},j.setScene=function(a){Game.instanceOf(a,"Game.Scene")&&(c=a)},j.getScene=function(){return c},j.setVisibility=function(a){Game.isBool(a)&&(d=a)},j.getVisibility=function(){return d},j.setX=function(a){Game.isNumber(a)&&(e=a)},j.getX=function(){return e},j.setY=function(a){Game.isNumber(a)&&(f=a)},j.getCollideOffset=function(){return g},j.getY=function(){return f},j.getMaterial=function(){return h},j.getDrawTime=function(){return i},j.width=function(){return h?h.width:0},j.height=function(){return h?h.height:0},j.move=function(a,b){Game.isNumber(a)&&Game.isNumber(b)&&(e+=a,f+=b)},j.moveTo=function(a,b){Game.isNumber(a)&&Game.isNumber(b)&&(e=a,f=b)},j.centerTo=function(a,b){var c,d;Game.isNumber(a)&&Game.isNumber(b)&&(c=this.width(),d=this.height(),e=a-c/2,f=b-d/2)},j.getCollidePointWithOther=function(a){var c,d,e,f,h,i,j,k,l,m,n,o,p,q,b=null;return Game.instanceOf(a,"Game.Sprite")&&(c=a.getX(),d=c+a.width(),e=a.getY(),f=e+a.height(),h=a.getCollideOffset(),c+=h,d-=h,e+=h,f-=h,i=this.getX(),j=i+this.width(),k=this.getY(),l=k+this.height(),i+=g,j-=g,k+=g,l-=g,m=!(c>=j||i>=d),n=!(e>=l||k>=f),m&&n&&(b={},o=function(a,b){var c=a-b;return c},p=[i,j,c,d],q=[k,l,e,f],p.sort(o),q.sort(o),b.x=(p[1]+p[2])/2,b.y=(q[1]+q[2])/2)),b},j.beforeDraw=function(){},j.draw=function(a){i++,this.beforeDraw(a),h&&a instanceof CanvasRenderingContext2D&&d&&(b=a,b.drawImage(h,e,f,h.width,h.height)),this.afterDraw(a)},j.afterDraw=function(){},j.beforeDestroy=function(){},j.destroy=function(){if(this.beforeDestroy(),Game.instanceOf(c,"Game.Scene")){var a=c.remove(this);return a&&(c=null,this.afterDestroy()),a}return!1},j.afterDestroy=function(){},j},Game.AutoSpriteMaker=function(a){var b,c,d,e;return a=a||{},b=Game.isNumber(a.speed)?a.speed:2,c=Game.SpriteMaker(a),c.addType("Game.AutoSprite"),d=c.beforeDraw,e=c.afterDraw,c.getSpeed=function(){return b},c.setSpeed=function(a){Game.isNumber(a)&&(b=a)},c.beforeDraw=function(){d.apply(this,arguments),this.move(0,b)},c.afterDraw=function(a){var b,c,d,f,g,h,i,j;return e.apply(this,arguments),b=a.canvas,c=b.width,d=b.height,f=this.getX(),g=this.getY(),h=this.width(),i=this.height(),j=0>=f+h||f>=c||0>=g+i||g>=d,j?(this.destroy(),!1):!0},c},Game.AwardMaker=function(a){var b,c,d;return a=a||{},a.speed=7,b="DOWN1",c=Game.AutoSpriteMaker(a),c.addType("Game.Award"),d=c.afterDraw,c.afterDraw=function(a){var e,f,g,c=d.apply(this,arguments);0!=c&&"DOWN3"!=b&&(e=a.canvas.height,f=this.getY(),g=f+this.height(),"DOWN1"==b?g>=.25*e&&(this.setSpeed(-5),b="UP2"):"UP2"==b&&g+this.getSpeed()<=0&&(this.setSpeed(13),b="DOWN3"))},c},Game.BombAwardMaker=function(a){a=a||{};var b=Game.AwardMaker(a);return b.addType("Game.BombAward"),b},Game.BulletAwardMaker=function(a){a=a||{};var b=Game.AwardMaker(a);return b.addType("Game.BulletAward"),b},Game.BulletMaker=function(a){a=a||{},a.down=!1,a.speed=-10;var b=Game.AutoSpriteMaker(a);return b.addType("Game.Bullet"),b},Game.EnemyPlaneMaker=function(a){var b,c,d,e,f,g;return a=a||{},a.down=!0,b=1,c=0,Game.isNumber(a.power)&&(d=Math.floor(a.power),d>0&&(b=d)),Game.isNumber(a.value)&&(e=Math.floor(a.value),e>0&&(c=e)),f=Game.AutoSpriteMaker(a),f.addType("Game.EnemyPlane"),g=f.afterDraw,f.afterDraw=function(){var c,d,e,f;if(g.apply(this,arguments),c=this.getScene())for(d=null,e=c.getSpritesByType("Game.Bullet");e.length>0;){if(f=e[0],d=this.getCollidePointWithOther(f),d&&(f.destroy(),b--,0>=b))return this.explode(),void 0;e.splice(0,1)}},f.explode=function(){var a,b,d;Game.addScore(c),a=this.getScene(),b=Game.getSpriteFactory(),a&&b&&(d={segment:14,centerX:this.getX()+this.width()/2,centerY:this.getY()+this.height()/2},a.add(b.createExplosion(d))),this.destroy()},f},Game.SmallEnemyPlaneMaker=function(a){a=a||{},a.power=1,a.value=1e3;var b=Game.EnemyPlaneMaker(a);return b.addType("Game.SmallEnemyPlane"),b},Game.MiddleEnemyPlaneMaker=function(a){a=a||{},a.power=4,a.value=6e3;var b=Game.EnemyPlaneMaker(a);return b.addType("Game.MiddleEnemyPlane"),b},Game.BigEnemyPlaneMaker=function(a){a=a||{},a.power=10,a.value=3e4;var b=Game.EnemyPlaneMaker(a);return b.addType("Game.BigEnemyPlane"),b},Game.CombatAircraftMaker=function(a){var b,c,d,e,f,g,h,i,j,k,l;return a=a||{},a.collideOffset=20,b=!1,c=0,d={single:!0,doubleTime:0,maxDoubleTime:140},e={isFlush:!1,isBeginFlush:!1,drawTime:0,beginDrawTime:0,flushTime:0,flushFrequency:16,maxFlushTime:10},f=Game.SpriteMaker(a),f.addType("Game.CombatAircraft"),g=f.move,h=f.moveTo,i=f.centerTo,j=f.beforeDraw,k=f.afterDraw,l=f.beforeDestroy,f.isCollide=function(){return b},f.setNotCollide=function(){b=!1},f.makePositionValid=function(){var c,d,e,f,a=this.getX(),b=this.getY();0>a&&(a=0),0>b&&(b=0),c=this.getContext2d(),c&&(d=c.canvas,e=a+this.width(),f=b+this.height(),e>d.width&&(a=d.width-this.width()),f>d.height&&(b=d.height-this.height())),this.setX(a),this.setY(b)},f.move=function(){g.apply(this,arguments),this.makePositionValid()},f.moveTo=function(){h.apply(this,arguments),this.makePositionValid()},f.centerTo=function(){i.apply(this,arguments),this.makePositionValid()},f.moveToCenterBottom=function(a){var b,c;Game.isCanvas(a)&&(b=a.width/2-this.width()/2,c=a.height-this.height(),this.moveTo(b,c))},f.beforeDraw=function(){if(!b){j.apply(this,arguments);var c=this.getDrawTime();0==c%7&&this.fight()}},f.afterDraw=function(){var f,g,h,i,j,l,m,n,o;if(k.apply(this,arguments),f=this.getScene(),g=null,!b)for(h=f.getSpritesByType("Game.EnemyPlane");h.length>0;){if(i=h[0],g=this.getCollidePointWithOther(i)){this.explode();break}h.splice(0,1)}if(e.isFlush&&(e.drawTime++,e.drawTime==e.beginDrawTime&&(this.setVisibility(!0),e.isBeginFlush=!0),e.isBeginFlush&&0==e.drawTime%e.flushFrequency&&(j=this.getVisibility(),this.setVisibility(!j),e.flushTime++,e.flushTime>=e.maxFlushTime&&(this.destroy(),Game.gameOver()))),!b){for(l=f.getSpritesByType("Game.BombAward");l.length>0;)m=l[0],g=this.getCollidePointWithOther(m),g&&(c++,m.destroy(),Game.receiveBombAward()),l.splice(0,1);for(n=f.getSpritesByType("Game.BulletAward");n.length>0;)o=n[0],g=this.getCollidePointWithOther(o),g&&(o.destroy(),d.single=!1,d.doubleTime=0),n.splice(0,1)}},f.beforeDestroy=function(){var a=l.apply(this,arguments);0!=a&&(e={isFlush:!1,isBeginFlush:!1,drawTime:0,beginDrawTime:0,flushTime:0,flushFrequency:16,maxFlushTime:10},d={single:!0,doubleTime:0,maxDoubleTime:600})},f.explode=function(){var a,c,d,f;b||(b=!0,a=this.getScene(),c=Game.getSpriteFactory(),a&&c&&(this.setVisibility(!1),d={centerX:this.getX()+this.width()/2,centerY:this.getY()+this.height()/2},f=c.createExplosion(d),a.add(f),e.beginDrawTime=f.getExplodeFrame(),e.isFlush=!0))},f.fight=function(){var c,e,f,g,h,a=this.getScene(),b=Game.getSpriteFactory();a&&b&&(c=this.getX()+this.width()/2,e=this.getY()-5,d.single?a.add(b.createYellowBullet({x:c,y:e})):(f=this.width()/4,g=c-f,h=c+f,a.add(b.createBlueBullet({x:g,y:e})),a.add(b.createBlueBullet({x:h,y:e})),d.doubleTime++,d.doubleTime>=d.maxDoubleTime&&(d.single=!0,d.doubleTime=0)))},f.bomb=function(){var a,b,d;if(c>0){if(a=this.getScene())for(b=a.getSpritesByType("Game.EnemyPlane");b.length>0;)d=b[0],d.explode(),b.splice(0,1);c--}},f},Game.ExplosionMaker=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return a=a||{},b=50,c=50,d=0,e=2,f=Game.isNumber(a.segment)&&Math.floor(a.segment)>=1?Math.floor(a.segment):1,g=Game.isNumber(a.centerX)?a.centerX:0,h=Game.isNumber(a.centerY)?a.centerY:0,i=0,j=null,k=a.material instanceof Image&&a.material.width>0&&a.material.height>0?a.material:null,k&&(b=k.width/f,c=k.height),l=g-b/2,m=h-c/2,a.x=l,a.y=m,n=Game.SpriteMaker(a),n.addType("Game.Explosion"),n.width=function(){return b},n.height=function(){return c},n.getDrawTime=function(){return i},n.draw=function(a){var e,f,g,h,n,o,p,q;i++,this.beforeDraw(a),k&&a instanceof CanvasRenderingContext2D&&this.getVisibility()&&(j=a,e=b*d,f=0,g=b,h=c,n=l,o=m,p=b,q=c,j.drawImage(k,e,f,g,h,n,o,p,q)),this.afterDraw(a)},n.afterDraw=function(){0==i%e&&(d++,d>=f&&this.destroy())},n.getExplodeFrame=function(){return f*e},n};